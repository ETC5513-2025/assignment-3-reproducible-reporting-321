<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Midhun Unnikrishnan">
<meta name="author" content="Sumintra Boonmat">
<meta name="author" content="Lin Qi">

<title>Assignment3 - Covid19: vaccination rates, case numbers, and death rates compare across France, Canada, Germany, India, the UK, and the US</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="Analysis_files/libs/quarto-html/quarto.js"></script>
<script src="Analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="Analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="Analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Analysis.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment3 - Covid19: vaccination rates, case numbers, and death rates compare across France, Canada, Germany, India, the UK, and the US</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Midhun Unnikrishnan </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            GitHub: <span class="citation" data-cites="MidhunUnnikrishnan7">@MidhunUnnikrishnan7</span>
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Sumintra Boonmat </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            GitHub: <span class="citation" data-cites="SumintraB">@SumintraB</span>
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Lin Qi </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            GitHub: <span class="citation" data-cites="linqi70">@linqi70</span>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="sec-intro" class="level1">
<h1>Executive Summary</h1>
<p>This report details a study of COVID-19 confirmed cases, deaths, and vaccination rates across Canada, France, Germany, India, the UK, and the US from February 2020 to July 2023. It shows the impact of vaccination on pandemic outcomes. Studies state that countries, including the US and UK, saw a decrease in both cases and deaths when vaccination uptake began at the onset of the pandemic. This analysis shows how vaccination has a proportionately large effect relative to decreasing pandemic numbers.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Since early 2020, countries around the globe have experienced COVID-19 to different extents. Governments responded with measures like testing, lockdowns, and mass vaccination, but the outcomes varied significantly. This study compares Canada, France, Germany, India, the UK, and the US to understand the contrast in outcomes. It researches time series data on confirmed cases, deaths, and vaccination rates from 2020 to 2023. The primary question focuses on the role of vaccination in decreasing case numbers and mortality rates. Vaccination programs started at varying times, with richer nations beginning earlier. For example, Canada and the United States started vaccinations in December 2020, while India began in January 2021. This study aims to provide insight into successful responses to the pandemic. It highlights the importance of vaccination in reducing the spread and severity of the virus.</p>
</section>
<section id="sec-method" class="level1">
<h1>Methodology</h1>
<p><strong>Data Source</strong>:</p>
<p>We used publicly available datasets from <a href="https://ourworldindata.org/coronavirus">Our World in Data</a>, including:</p>
<ul>
<li><p>Confirmed COVID-19 case numbers: https://ourworldindata.org/covid-cases</p></li>
<li><p>COVID-19 death data: https://ourworldindata.org/covid-deaths</p></li>
<li><p>COVID-19 vaccination data: https://ourworldindata.org/covid-vaccinations</p></li>
</ul>
<p><strong>Time Range Validation</strong>:</p>
<ul>
<li><p>Confirmed Cases: February 1, 2020 - February 1, 2023</p></li>
<li><p>Death Rates: February 1, 2020 - February 1, 2023</p></li>
<li><p>Vaccination Data:</p></li>
</ul>
<p>The vaccination dataset was obtained from Our World in Data. We observed that different countries had different vaccination start and end dates. For example, Canada and the US began recording vaccinations in December 2020, while India started in mid-January 2021. These differences are likely due to unequal access to vaccines and different national data reporting schedules.</p>
<p>To ensure fair comparisons, we limited our analysis to the overlapping period across all six countries: from January 16, 2021 to September 4, 2022. This allows for consistent visualization and avoids bias caused by missing early or late-stage data in certain countries.</p>
<p><strong>Data Cleaning and Preprocessing</strong>:</p>
<p>Before analysis, we checked for missing values in the vaccination dataset. We removed any records with missing doses per million using Râ€™s <code>filter(!is.na(...))</code> function.</p>
<p>We then merged the confirmed case dataset with the vaccination dataset by country and date. To ensure valid comparisons across countries, we filtered the merged dataset to include only the common time range where all countries had vaccination data available.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-vacc-trend" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vacc-trend-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Analysis_files/figure-html/fig-vacc-trend-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vacc-trend-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Figure: COVID-19 vaccine: 7-day average doses per million (by country)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div id="tbl-vacc-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-vacc-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Table: Summary of vaccination data coverage (start-end date by country)
</figcaption>
<div aria-describedby="tbl-vacc-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Country</th>
<th style="text-align: left;">Start</th>
<th style="text-align: left;">End</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Canada</td>
<td style="text-align: left;">2020-12-15</td>
<td style="text-align: left;">2023-07-31</td>
</tr>
<tr class="even">
<td style="text-align: left;">France</td>
<td style="text-align: left;">2020-12-28</td>
<td style="text-align: left;">2023-07-31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">2020-12-28</td>
<td style="text-align: left;">2023-07-31</td>
</tr>
<tr class="even">
<td style="text-align: left;">India</td>
<td style="text-align: left;">2021-01-16</td>
<td style="text-align: left;">2023-07-31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: left;">2021-01-11</td>
<td style="text-align: left;">2022-09-04</td>
</tr>
<tr class="even">
<td style="text-align: left;">United States</td>
<td style="text-align: left;">2020-12-15</td>
<td style="text-align: left;">2023-05-09</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#fig-vacc-trend" class="quarto-xref">Figure&nbsp;1</a> shows the 7-day average vaccination doses per million across the six countries. Canada, France, Germany, the UK, and the US all ramped up vaccination rapidly during early 2021, while India lagged slightly behind, with a noticeable delay in rollout. <a href="#tbl-vacc-summary" class="quarto-xref">Table&nbsp;1</a> confirms the start and end dates of vaccine data coverage, showing that most countries began vaccination efforts in late December 2020. This aligns with Our World in Dataâ€™s findings that vaccine rollout was uneven globally, with lower coverage in lower-income regions.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-vacc-vs-case" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vacc-vs-case-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Analysis_files/figure-html/fig-vacc-vs-case-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vacc-vs-case-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Figure: Comparison of confirmed cases and vaccination rates per million (by country)
</figcaption>
</figure>
</div>
</div>
</div>
<p>In order to more clearly understand the temporal relationship between COVID-19 outbreaks and vaccination, we constructed the <a href="#fig-vacc-vs-case" class="quarto-xref">Figure&nbsp;2</a>, which displays the number of daily diagnoses per million people overlaid on the number of vaccinations, arranged faceted by country. We can see that the number of confirmed cases increased before the vaccination rate started to rise. This means that many governments began to roll out vaccines after the number of cases went up. This figure is useful for visualizing the timing between outbreaks and vaccination responses. It helps us see whether vaccines were given early or late during a wave.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-daily-change" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-daily-change-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Analysis_files/figure-html/fig-daily-change-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-daily-change-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Figure: Daily changes in confirmed cases and vaccine doses per million
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-daily-change" class="quarto-xref">Figure&nbsp;3</a> highlights the daily change in confirmed cases and vaccinations. It shows how much each number went up or down each day. We can see during major outbreaks, the daily changes were large. There were big increases in confirmed cases, and then some countries also had big jumps in vaccination. This figure helps us understand how fast things changed. It also shows how quickly some countries reacted when cases increased.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-lag-effect" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lag-effect-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Analysis_files/figure-html/fig-lag-effect-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lag-effect-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Figure: Lagged vaccination rate vs confirmed cases (7-day lag, by country)
</figcaption>
</figure>
</div>
</div>
</div>
<p>To understand if vaccines helped reduce new COVID-19 cases, we looked at vaccination rates with a 7-day lag. This means we checked if higher vaccination numbers one week earlier were linked to fewer new cases later. The <a href="#fig-lag-effect" class="quarto-xref">Figure&nbsp;4</a> shows that in countries like the US and UK, when more people were vaccinated, new case numbers often went down after a few days. This suggests that vaccines helped slow the spread of the virus.</p>
<p>However, as Our World in Data points out, vaccines became less effective in stopping infections over time, especially when new variants appeared. Even so, they still helped reduce the number of serious cases and deaths.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-case-death-vacc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-case-death-vacc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Analysis_files/figure-html/fig-case-death-vacc-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-case-death-vacc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Figure: COVID-19 confirmed case-death rates-vaccination by country)
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-case-death-vacc" class="quarto-xref">Figure&nbsp;5</a> compares the trends of confirmed cases, death rates, and vaccination rates across six countries. Earlier wavesâ€”before widespread vaccinationâ€”showed a much closer link between cases and deaths.</p>
<p>This pattern suggests that vaccination programs, alongside other public health measures, played a key role in reducing the severity of outcomes even when infection levels remained high.</p>
<p>The trend is less clear in countries with shorter or later vaccination coverage, such as India, possibly due to data gaps or other healthcare constraints.</p>
<p>We found that countries with early and wide vaccination had better control of the virus. In these places, case numbers went down after people started getting vaccinated. Later waves of COVID-19 caused fewer deaths than early ones. This shows that vaccines helped not only to stop the spread, but also to stop people from dying. Vaccination made a big difference.</p>
</section>
<section id="sec-results" class="level1">
<h1>Results</h1>
<p>The daily changes in COVID-19 case and vaccination rates in <a href="#fig-daily-change" class="quarto-xref">Figure&nbsp;3</a> shows that large outbreaks triggered spikes in vaccination, indicating reactive public health responses. Similarly, <a href="#fig-vacc-vs-case" class="quarto-xref">Figure&nbsp;2</a>, shows that vaccines were often given after case numbers had already started rising.</p>
<p>In early stages of the pandemic, before vaccination were widely available, the number of deaths closely followed the number of confirmed cases. However, as vaccination rates increased, the gap between cases and deaths widened, suggesting that vaccines helped reduce the severity of outcomes as per <a href="#fig-case-death-vacc" class="quarto-xref">Figure&nbsp;5</a> illustrates trends in confirmed COVID-19 cases, deaths, and vaccination rates per million across six countries.</p>
<p>In countries like the United States and United Kingdom, higher vaccination rates were often followed by declines in new case numbers. This is also shown in <a href="#fig-lag-effect" class="quarto-xref">Figure&nbsp;4</a>, which used a 7-day delay to study the effect of vaccines. It suggests vaccines helped slow down the spread of the virus soon after rollout.</p>
<p>The overall findings show that vaccination contributed to lower death rates and reduced the impact of major outbreaks when implemented early.</p>
</section>
<section id="sec-discussion" class="level1">
<h1>Discussion</h1>
<ol type="1">
<li>Case rates depend heavily on how much testing was available and how consistently it was used. Some countries, particularly in early stages of the pandemic, had limited testing capacity, meaning many infections may have gone unrecorded. In contrast, countries with widespread and frequent testing likely reported more cases, even among people with mild or no symptoms.</li>
<li>The differences in how countries report COVID-19 deaths may affect the accuracy of comparisons. For example, some countries may only rec</li>
</ol>
</section>
<section id="sec-conclusion" class="level1">
<h1>Conclusion</h1>
<p>During the project, we analyzed numbers of confirmed cases, deaths and vaccinations in Canada, France, Germany, India, the UK and the US.</p>
<p>Our findings highlight three key observations:</p>
<ol type="1">
<li><p>In most countries, the number of cases increased quite a bit before widespread vaccination took place.</p></li>
<li><p>During major outbreaks, both case numbers and vaccine doses administered showed significant daily fluctuations.</p></li>
<li><p>A 7-day lag analysis indicated that rising vaccination rates were followed by a reduction in new case numbers. Areas where vaccination started early and was kept up showed the strongest impact.</p></li>
</ol>
<p>These insights suggest that timely and sustained vaccination campaigns played a crucial role in reducing transmission and saving lives. Future public health responses should prioritize early vaccine deployment during pandemics.</p>
</section>
<section id="sec-recommendations" class="level1">
<h1>Recommendations</h1>
<p>Given the findings, we suggest that further pandemic responses concentrate on spreading vaccinations quickly, especially in lower-income parts of the world like India, in order to reduce chances for breaks in case numbers. As seen in <a href="#fig-daily-change" class="quarto-xref">Figure&nbsp;3</a>, rather than waiting for a surge, Governments should consider establishing proactive vaccination schemes, ensuring vaccines are deployed before a high number of cases occur. Having comparable ways of reporting data in different nations allows for better assessment and guides effective policy creation. Finally such campaigns need to make sure vaccination efforts continue, because sustained work in the US and UK greatly reduced the number of people affected and the death rate, as shown in <a href="#fig-case-death-vacc" class="quarto-xref">Figure&nbsp;5</a>.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>